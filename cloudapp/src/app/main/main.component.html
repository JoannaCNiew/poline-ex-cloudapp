<style>
  .preview-card .mat-form-field-subscript-wrapper {
    display: none;
  }
</style>

<app-topmenu></app-topmenu>

<div class="cloudapp-body">
    <mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>

    <div class="main-content">
        <ng-container *ngIf="visibleEntities.length > 0; then entitylist; else noentities"></ng-container>

        <ng-template #noentities>
            <div class="cloudapp-body">
                <h1 translate>Main.NoEntities.Title</h1>
                <p translate>Main.NoEntities.Description</p>
            </div>
        </ng-template>

        <ng-template #entitylist>
            <div class="cloudapp-body">

                <mat-card *ngIf="visibleEntities.length > 0">
                    <mat-card-header>
                        <mat-card-title *ngIf="selectedEntities.length === 0" style="font-size: 17px; font-weight: normal;">{{ titleSelectText }}</mat-card-title>
                        <mat-card-title *ngIf="selectedEntities.length > 0" style="font-size: 17px; font-weight: normal;">{{ titleOptionsText }}</mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        
                        <div class="export-actions" style="display: flex; flex-direction: row; align-items: center; margin-top: 10px;">

                            <button mat-raised-button color="primary" (click)="onGenerateExport()" [disabled]="loading || selectedEntities.length === 0">
                                <mat-icon>visibility</mat-icon>
                                <span>{{ previewButtonText }}</span>
                            </button>
                            
                            <button mat-raised-button color="accent" 
                                (click)="copyToClipboard()" 
                                [disabled]="loading || selectedEntities.length === 0" 
                                style="margin-left: 10px;">
                                <mat-icon>content_copy</mat-icon>
                                <span>{{ copyButtonText }}</span>
                            </button>

                            <button mat-raised-button color="primary" 
                                (click)="downloadFile()" 
                                [disabled]="loading || selectedEntities.length === 0" 
                                style="margin-left: 10px;">
                                <mat-icon>save_alt</mat-icon>
                                <span>{{ downloadButtonText }}</span>
                            </button>
                        </div>
                        
                        <div *ngIf="loading" style="margin-top: 10px;">
                            <small translate>Main.EntityList.Loading</small>
                        </div>

                    </mat-card-content>
                </mat-card>

                <mat-card *ngIf="previewContent" class="preview-card">
                    <mat-card-header>
                        <mat-card-title style="font-size: 17px; font-weight: normal;" translate>Main.EntityList.PreviewTitle</mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        <textarea matInput rows="5" [value]="previewContent" readonly #exportTextArea class="mat-input-element" style="width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 5px; box-sizing: border-box; resize: vertical;"></textarea>
                    </mat-card-content>
                </mat-card>
                
                <mat-card>
                    <mat-card-header>
                        <mat-card-title style="font-size: 17px; font-weight: normal;">
                            <span>{{ selectTitleText }}</span> ({{ selectedEntities.length }}/{{ visibleEntities.length }})
                        </mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        
                        <eca-select-entities #selectEntities
                            [(selected)]="selectedEntities" >
                        </eca-select-entities>

                    </mat-card-content>
                </mat-card>

            </div>
        </ng-template>
    </div>
</div>

<div class="loading-shade" *ngIf="loading">
  <mat-spinner diameter="50"></mat-spinner>
</div>